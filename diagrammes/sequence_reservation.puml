@startuml
!theme plain
title Diagramme de Séquence - Réservation de Rendez-vous

actor "Utilisateur" as User
participant "Frontend" as FE
participant "Backend API" as API
participant "Base de Données" as DB
participant "Système de Paiement" as Payment

User -> FE: Sélectionne prestataire
FE -> API: GET /api/service/list
API -> DB: Récupère services disponibles
DB --> API: Liste des services
API --> FE: Services avec créneaux
FE --> User: Affiche services et créneaux

User -> FE: Choisit créneau
FE -> API: POST /api/user/book-appointment
API -> DB: Vérifie disponibilité
DB --> API: Créneau disponible

alt Créneau disponible
    API -> DB: Crée réservation
    DB --> API: Réservation créée
    API --> FE: Confirmation réservation
    FE --> User: Affiche confirmation
    
    User -> FE: Procède au paiement
    FE -> API: POST /api/user/payment-stripe
    API -> Payment: Crée session paiement
    Payment --> API: URL de paiement
    API --> FE: URL de paiement
    FE -> Payment: Redirige vers paiement
    
    Payment -> API: Webhook confirmation
    API -> DB: Met à jour statut paiement
    DB --> API: Paiement confirmé
    API -> FE: Notification paiement
    FE --> User: Confirmation finale
    
else Créneau non disponible
    API --> FE: Erreur - Créneau occupé
    FE --> User: Message d'erreur
end

@enduml